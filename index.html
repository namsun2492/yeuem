<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tỏ Tình Lãng Mạn</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000020;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #popup-container {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      box-shadow: 0 0 15px #00bfff;
      text-align: center;
      z-index: 3000;
    }

    #question {
      font-size: 1.2em;
      margin-bottom: 15px;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #00bfff;
      margin-bottom: 15px;
      box-sizing: border-box;
      color: black;
    }

    button {
      background: #00bfff;
      border: none;
      padding: 10px 20px;
      color: white;
      font-weight: 600;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 10px #00bfff;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background: #0080b3;
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes floatUpDown {
      0% { transform: translateY(0); }
      100% { transform: translateY(-20px); }
    }
  </style>
</head>
<body>
  <div id="popup-container">
    <div id="question"></div>
    <input type="text" id="answer" autocomplete="off" />
    <button id="next-btn">Kế tiếp</button>
  </div>

  <canvas id="heart-canvas"></canvas>

  <!-- Nhạc nền -->
  <audio id="background-music" 
         src="https://loadedmedia.store/uploads/music/2025/05/LBI-Jumping-Machine.mp3" 
         autoplay muted loop></audio>

  <script>
    const questions = [
      "Người em yêu thích nhất là ai?",
      "Bài hát em thích nhất là gì?",
      "Khi buồn em muốn làm gì nhất?",
      "Em muốn ở bên ai nhất?",
      "Khi cô đơn em nhớ ai?",
      "Em buồn em có nhớ anh không?"
    ];

    const baseMessages = [
      "Anh yêu em", "Em là định mệnh của anh", "Mãi bên nhau nhé",
      "Anh nhớ em từng giây phút", "Không ai thay thế được em",
      "Chỉ cần em hạnh phúc, anh sẽ luôn chờ", "Tình yêu anh dành cho em là mãi mãi",
      "Ngọc Thuận, anh rất yêu em", "Hãy cùng nhau đi đến cuối con đường nhé",
      "Anh thề sẽ luôn bảo vệ em"
    ];
    const loveMessages = Array.from({ length: 1000 }, () =>
      baseMessages[Math.floor(Math.random() * baseMessages.length)]
    );

    let currentQuestion = 0;
    const questionEl = document.getElementById('question');
    const answerEl = document.getElementById('answer');
    const nextBtn = document.getElementById('next-btn');
    const popupContainer = document.getElementById('popup-container');
    const music = document.getElementById('background-music');
    let musicStarted = false;

    function showQuestion(index) {
      questionEl.textContent = questions[index];
      answerEl.value = '';
      answerEl.focus();
    }

    answerEl.addEventListener("keydown", function (e) {
      if (e.key === "Enter") nextBtn.click();
    });

    nextBtn.addEventListener('click', () => {
      if (!musicStarted) {
        music.muted = false;
        music.play().catch(() => {});
        musicStarted = true;
      }
      alert("Anh yêu em");
      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion(currentQuestion);
      } else {
        popupContainer.style.display = 'none';
        startHeartRain();
      }
    });

    showQuestion(currentQuestion);

    const canvas = document.getElementById('heart-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let hearts = [], snowflakes = [], heartParticles = [];
    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;

    class Snowflake {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * -canvas.height;
        this.radius = Math.random() * 2 + 1;
        this.speedY = Math.random() * 1 + 0.5;
        this.wind = Math.random() * 0.5 - 0.25;
      }
      update() {
        this.y += this.speedY;
        this.x += this.wind;
        if (this.y > canvas.height) this.reset();
      }
      draw() {
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    class Heart {
      constructor() { this.reset(); }
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 6 + 4;
        this.alpha = Math.random() * 0.5 + 0.5;
        this.speedY = Math.random() * 0.3 + 0.2;
      }
      update() {
        this.y -= this.speedY;
        if (this.y < -10) this.reset();
      }
      draw() {
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = "#00bfff";
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.bezierCurveTo(this.x - this.size / 2, this.y - this.size / 2,
                          this.x - this.size, this.y + this.size / 2,
                          this.x, this.y + this.size);
        ctx.bezierCurveTo(this.x + this.size, this.y + this.size / 2,
                          this.x + this.size / 2, this.y - this.size / 2,
                          this.x, this.y);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    class HeartParticle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * 4 + 2;
        this.speed = Math.random() * 2 + 1;
        this.alpha = 1;
        this.angle = Math.atan2(mouseY - y, mouseX - x);
      }

      update() {
        this.x += this.speed * Math.cos(this.angle);
        this.y += this.speed * Math.sin(this.angle);
        this.alpha -= 0.01;
      }

      draw() {
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = "#00bfff";
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.bezierCurveTo(this.x - this.size / 2, this.y - this.size / 2,
                          this.x - this.size, this.y + this.size / 2,
                          this.x, this.y + this.size);
        ctx.bezierCurveTo(this.x + this.size, this.y + this.size / 2,
                          this.x + this.size / 2, this.y - this.size / 2,
                          this.x, this.y);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function createHearts(n) {
      for (let i = 0; i < n; i++) hearts.push(new Heart());
    }
    function createSnow(n) {
      for (let i = 0; i < n; i++) snowflakes.push(new Snowflake());
    }

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      snowflakes.forEach(f => { f.update(); f.draw(); });
      hearts.forEach(h => { h.update(); h.draw(); });
      heartParticles.forEach(p => { p.update(); p.draw(); });
      heartParticles = heartParticles.filter(p => p.alpha > 0);
    }

    function createLovePopup(msg) {
      const p = document.createElement('div');
      p.style.position = 'fixed';
      p.style.top = `${Math.random() * (innerHeight - 150) + 50}px`;
      p.style.left = `${Math.random() * (innerWidth - 250) + 50}px`;
      p.style.width = '220px';
      p.style.padding = '10px 15px';
      p.style.background = 'rgba(0,191,255,0.9)';
      p.style.color = 'white';
      p.style.fontSize = '16px';
      p.style.borderRadius = '10px';
      p.style.boxShadow = '0 0 10px #00bfff';
      p.style.zIndex = '2000';
      p.style.cursor = 'pointer';
      p.style.animation = 'floatUpDown 2.5s ease-in-out infinite alternate';
      p.innerHTML = msg;
      p.addEventListener('click', () => p.remove());
      document.body.appendChild(p);
      setTimeout(() => { if (p.parentElement) p.remove(); }, 10000);
    }

    function generateLovePopupsInfinite() {
      setInterval(() => {
        const msg = loveMessages[Math.floor(Math.random() * loveMessages.length)];
        createLovePopup(msg);
      }, 80);
    }

    function startHeartRain() {
      createHearts(150);
      createSnow(100);
      function animate() {
        drawScene();
        requestAnimationFrame(animate);
      }
      animate();
      generateLovePopupsInfinite();
    }

    window.addEventListener('resize', () => {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    });

    document.addEventListener('mousemove', e => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      for (let i = 0; i < 2; i++) {
        heartParticles.push(new HeartParticle(
          Math.random() * canvas.width,
          Math.random() * canvas.height
        ));
      }
    });

    window.addEventListener('DOMContentLoaded', () => {
      music.muted = false;
      music.play().catch(() => {});
    });
  </script>
</body>
</html>
